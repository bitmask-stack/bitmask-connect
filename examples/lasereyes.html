<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bitmask Connect – LaserEyes (No React)</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        margin: 24px;
      }
      h1 {
        margin-top: 0;
      }
      .row {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
      }
      .card {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        max-width: 720px;
      }
      .card h2 {
        margin: 0 0 12px;
        font-size: 16px;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 8px;
      }
      button {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        background: #fff;
        border-radius: 6px;
        cursor: pointer;
      }
      button:hover {
        background: #f9fafb;
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
        font-size: 12px;
        white-space: pre-wrap;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        padding: 12px;
        border-radius: 8px;
      }
      .wallet {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        border-radius: 8px;
      }
      img {
        width: 20px;
        height: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Bitmask Connect – LaserEyes (No React)</h1>
    <p>
      Simulated LaserEyes wallet selection UI using the adapter API. No React
      required.
    </p>

    <div class="card">
      <h2>Wallets</h2>
      <div id="wallets"></div>
      <div class="controls" style="margin-top: 12px">
        <button id="toggleBtn">Connect</button>
      </div>
    </div>

    <div class="card" style="margin-top: 16px">
      <h2>State</h2>
      <pre id="state" class="mono">{}</pre>
    </div>

    <div class="card" style="margin-top: 16px">
      <h2>Basic Wallet Operations (LaserEyes Interface)</h2>
      <div class="controls" style="margin-top: 12px">
        <button id="detectBtn">Detect</button>
        <button id="pubBtn">getPubKeyHash</button>
        <button id="addrBtn">getAddress</button>
        <button id="fundedBtn">isFunded</button>
        <button id="assetsBtn">getAssets</button>
      </div>
    </div>

    <div class="card" style="margin-top: 16px">
      <h2>Advanced Bitmask Operations (via adapter.bitmask)</h2>
      <div class="controls" style="margin-top: 12px">
        <button id="vaultBtn">getVault</button>
        <button id="usernameBtn">getUsername</button>
        <button id="userDataBtn">getUserData</button>
        <button id="issueUdaBtn">issueUDA</button>
        <button id="issueAssetBtn">issueAsset</button>
        <button id="bulkIssueBtn">bulkIssueUDA</button>
        <button id="invoiceBtn">getInvoice</button>
        <button id="sendSatsBtn">sendSats</button>
        <button id="mintPerSatsBtn">mintPerSats</button>
        <button id="swapOfferBtn">swapOffer</button>
        <button id="swapBidBtn">swapBid</button>
        <button id="passAssetBtn">passAsset</button>
        <button id="transferBtn">transfer</button>
      </div>
      <pre id="out" class="mono"></pre>
    </div>

    <script type="module">
      import {
        BITMASK,
        createBitmaskWallet,
        getBitmaskButton,
      } from "../dist/lasereyes.js";

      const wallet = createBitmaskWallet({
        onConnect: (s) => renderState(s),
        onDisconnect: () => renderState(wallet.getState()),
        onRefresh: () => console.log("refresh broadcast received"),
      });

      const walletsEl = document.getElementById("wallets");
      const stateEl = document.getElementById("state");
      const outEl = document.getElementById("out");

      function renderWallet(w) {
        const wrap = document.createElement("div");
        wrap.className = "wallet";
        const img = document.createElement("img");
        img.src = w.icon;
        const span = document.createElement("span");
        span.textContent = w.name;
        wrap.appendChild(img);
        wrap.appendChild(span);
        return wrap;
      }

      function renderState(s) {
        stateEl.textContent = JSON.stringify(s, null, 2);
      }

      walletsEl.appendChild(renderWallet(wallet));
      renderState(wallet.getState());

      const toggleBtn = document.getElementById("toggleBtn");
      async function refreshToggle() {
        toggleBtn.textContent = wallet.connected() ? "Disconnect" : "Connect";
      }
      toggleBtn.onclick = async () => {
        if (!wallet.connected()) {
          try {
            const s = await wallet.connect();
            renderState(s);
          } catch (e) {
            alert(e.message || String(e));
          }
        } else {
          await wallet.disconnect();
          renderState(wallet.getState());
        }
        refreshToggle();
      };
      refreshToggle();

      function log(title, data) {
        outEl.textContent = `${title}:\n` + JSON.stringify(data, null, 2);
      }

      // Helper to ensure wallet is connected and get pubkeyHash
      async function ensureConnected() {
        if (!wallet.connected()) {
          await wallet.connect();
        }
        const state = wallet.getState();
        if (!state.pubkeyHash) {
          throw new Error("Wallet not connected or no pubkeyHash");
        }
        return state.pubkeyHash;
      }

      // Basic wallet operations (LaserEyes interface)
      document.getElementById("detectBtn").onclick = async () => {
        const bmState = await wallet.connect().catch(() => wallet.getState());
        log("detect/connect", bmState);
      };

      document.getElementById("pubBtn").onclick = async () => {
        try {
          const res = await wallet.bitmask.getPubKeyHash();
          log("getPubKeyHash (via adapter.bitmask)", res);
        } catch (e) {
          log("getPubKeyHash", { error: String(e) });
        }
      };

      document.getElementById("addrBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.getAddress({ pubkeyHash });
          log("getAddress (via adapter.bitmask)", res);
        } catch (e) {
          log("getAddress", { error: String(e) });
        }
      };

      document.getElementById("fundedBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.isFunded({ pubkeyHash });
          log("isFunded (via adapter.bitmask)", res);
        } catch (e) {
          log("isFunded", { error: String(e) });
        }
      };

      document.getElementById("assetsBtn").onclick = async () => {
        try {
          const res = await wallet.bitmask.getAssets();
          log("getAssets (via adapter.bitmask)", res);
        } catch (e) {
          log("getAssets", { error: String(e) });
        }
      };

      // Advanced Bitmask operations (via adapter.bitmask)
      document.getElementById("vaultBtn").onclick = async () => {
        try {
          const res = await wallet.bitmask.getVault();
          log("getVault (via adapter.bitmask)", res);
        } catch (e) {
          log("getVault", { error: String(e) });
        }
      };

      document.getElementById("usernameBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.getUsername({ pubkeyHash });
          log("getUsername (via adapter.bitmask)", res);
        } catch (e) {
          log("getUsername", { error: String(e) });
        }
      };

      document.getElementById("userDataBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.getUserData({ pubkeyHash });
          log("getUserData (via adapter.bitmask)", res);
        } catch (e) {
          log("getUserData", { error: String(e) });
        }
      };

      document.getElementById("issueUdaBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.issueUDA({
            pubkeyHash,
            uda: { name: "Example UDA" },
          });
          log("issueUDA (via adapter.bitmask)", res);
        } catch (e) {
          log("issueUDA", { error: String(e) });
        }
      };

      document.getElementById("issueAssetBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.issueAsset({
            pubkeyHash,
            uda: { name: "Example Asset" },
          });
          log("issueAsset (via adapter.bitmask)", res);
        } catch (e) {
          log("issueAsset", { error: String(e) });
        }
      };

      document.getElementById("bulkIssueBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.bulkIssueUDA({
            pubkeyHash,
            uda: [{ name: "Bulk UDA 1" }, { name: "Bulk UDA 2" }],
          });
          log("bulkIssueUDA (via adapter.bitmask)", res);
        } catch (e) {
          log("bulkIssueUDA", { error: String(e) });
        }
      };

      document.getElementById("invoiceBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.getInvoice({
            pubkeyHash,
            uda: { name: "Example" },
          });
          log("getInvoice (via adapter.bitmask)", res);
        } catch (e) {
          log("getInvoice", { error: String(e) });
        }
      };

      document.getElementById("sendSatsBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.sendSats({
            pubkeyHash,
            recipientAddress: "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",
            amount: 1000,
            feeRate: 1,
          });
          log("sendSats (via adapter.bitmask)", res);
        } catch (e) {
          log("sendSats", { error: String(e) });
        }
      };

      document.getElementById("mintPerSatsBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.mintPerSats({
            pubkeyHash,
            uda: { name: "Example Mint" },
            paymentAmount: 1000,
            recipientAddress: "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",
          });
          log("mintPerSats (via adapter.bitmask)", res);
        } catch (e) {
          log("mintPerSats", { error: String(e) });
        }
      };

      document.getElementById("swapOfferBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.swapOffer({
            pubkeyHash,
            offerData: { price: 1000 },
          });
          log("swapOffer (via adapter.bitmask)", res);
        } catch (e) {
          log("swapOffer", { error: String(e) });
        }
      };

      document.getElementById("swapBidBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.swapBid({
            pubkeyHash,
            bidData: { bid: 1000 },
            contract: { terms: "example" },
          });
          log("swapBid (via adapter.bitmask)", res);
        } catch (e) {
          log("swapBid", { error: String(e) });
        }
      };

      document.getElementById("passAssetBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.passAsset({
            pubkeyHash,
            udaData: { name: "Passed Asset" },
          });
          log("passAsset (via adapter.bitmask)", res);
        } catch (e) {
          log("passAsset", { error: String(e) });
        }
      };

      document.getElementById("transferBtn").onclick = async () => {
        try {
          const pubkeyHash = await ensureConnected();
          const res = await wallet.bitmask.transfer({
            pubkeyHash,
            udaData: { name: "Transferred Asset" },
          });
          log("transfer (via adapter.bitmask)", res);
        } catch (e) {
          log("transfer", { error: String(e) });
        }
      };
    </script>
  </body>
</html>
